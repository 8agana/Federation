<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competition Sign-Up Form for Carrd</title>
    <style>
        /* Import Montserrat font */
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap');
        
        /* Styling to match Sam Atagana Photography website - Revised */
        .form-container {
            max-width: 600px;
            margin: 0 auto;
            font-family: 'Montserrat', sans-serif; /* Font Update */
            background-color: transparent; /* Style Update: Transparent background */
            color: #444444; /* Style Update: Default text color */
        }
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
        }
        .form-group {
            margin-bottom: 20px; /* Layout Improvement: Uniform spacing */
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #444444; /* Style Update: Text color */
        }
        .form-dropdown {
            width: 100%;
            padding: 12px;
            border-radius: 4px;
            border: 1px solid #d3d3d3;
            background-color: #fafafa;
            font-size: 16px;
            font-family: 'Montserrat', sans-serif; /* Font Update */
            color: #444444; /* Style Update: Text color */
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23444444%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E"); /* Style Update: Arrow color */
            background-repeat: no-repeat;
            background-position: right 12px top 50%;
            background-size: 12px auto;
        }
        .form-input {
            width: 100%;
            padding: 12px;
            border-radius: 4px;
            border: 1px solid #d3d3d3;
            font-size: 16px;
            font-family: 'Montserrat', sans-serif; /* Font Update */
            box-sizing: border-box;
            background-color: #fafafa;
            color: #444444; /* Style Update: Text color */
        }
        .form-textarea {
            width: 100%;
            padding: 12px;
            border-radius: 4px;
            border: 1px solid #d3d3d3;
            min-height: 120px;
            font-size: 16px;
            font-family: 'Montserrat', sans-serif; /* Font Update */
            background-color: #fafafa;
            box-sizing: border-box;
            color: #444444; /* Style Update: Text color */
        }
        .form-checkbox {
            margin-right: 8px;
        }
        .checkbox-label {
            display: flex;
            align-items: center;
            font-weight: normal;
            color: #444444; /* Style Update: Text color */
        }
        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .back-button, .next-button, .submit-button {
            padding: 10px 20px; /* Layout Improvement: Button padding */
            background-color: #444444; /* Style Update: Button background */
            color: #f2f2f2; /* Style Update: Button text color */
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-family: 'Montserrat', sans-serif; /* Font Update */
            cursor: pointer;
        }
        .back-button:hover, .next-button:hover, .submit-button:hover {
            opacity: 0.9; /* Simple hover effect */
        }
        .error-message {
            color: red;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #d3d3d3;
            margin: 0 5px;
        }
        .step-dot.active {
            background-color: #444444; /* Style Update: Active step color */
        }
        .skater-fields {
            display: none;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed #d3d3d3;
        }
        .skater-fields.active {
            display: block;
        }
        /* Sequential Checkbox: Hide subsequent checkboxes initially */
        .skater-checkbox-group {
            display: none;
        }
        .skater-checkbox-group.visible {
            display: block;
        }
    </style>
</head>
<body>
    <!-- 
    CARRD COMPETITION SIGN-UP FORM - FINALIZED (with latest revisions)
    
    INSTRUCTIONS:
    1. In Carrd, add an "Embed" element
    2. Set Type to "Code"
    3. Paste this entire HTML code
    4. For Google Sheets integration, follow the instructions in the accompanying guide
    5. Create a "Thank You" page in Carrd with the URL path /thank-you.html
    -->
    
    <div class="form-container">
        <form id="competitionForm" class="competition-form">
            <!-- Honeypot field for spam protection -->
            <input type="text" name="website" style="display:none;">
            
            <div class="step-indicator">
                <div class="step-dot active" data-step="1"></div>
                <div class="step-dot" data-step="2"></div>
                <div class="step-dot" data-step="3"></div>
            </div>
            
            <!-- Step 1: Select Competition -->
            <div class="form-step step-1 active">
                <div class="form-group">
                    <label for="competitionSelect" class="form-label">Select Your Competition *</label> <!-- Style Update: Proper Case -->
                    <select id="competitionSelect" name="competitionSelect" class="form-dropdown" required>
                        <option value="" disabled selected>Select an option</option>
                        <!-- Competition options will be populated dynamically via JavaScript -->
                    </select>
                    <div class="error-message" id="competitionSelect-error">Please select a competition</div>
                </div>
                
                <div class="button-container">
                    <div></div> <!-- Empty div for flex spacing -->
                    <button type="button" class="next-button" id="step1Next">Next</button>
                </div>
            </div>
            
            <!-- Step 2: Requester Information -->
            <div class="form-step step-2">
                <div class="form-group">
                    <label for="requesterFirstName" class="form-label">Requester's First Name *</label> <!-- Style Update: Proper Case -->
                    <input type="text" id="requesterFirstName" name="requesterFirstName" class="form-input" required>
                    <div class="error-message" id="requesterFirstName-error">Please enter your first name</div>
                </div>
                
                <div class="form-group">
                    <label for="requesterLastName" class="form-label">Requester's Last Name *</label> <!-- Style Update: Proper Case -->
                    <input type="text" id="requesterLastName" name="requesterLastName" class="form-input" required>
                    <div class="error-message" id="requesterLastName-error">Please enter your last name</div>
                </div>
                
                <div class="form-group">
                    <label for="requesterEmail" class="form-label">Requester's Email *</label> <!-- Style Update: Proper Case -->
                    <input type="email" id="requesterEmail" name="requesterEmail" class="form-input" required>
                    <div class="error-message" id="requesterEmail-error">Please enter a valid email address</div>
                </div>
                
                <div class="form-group">
                    <label for="requesterPhone" class="form-label">Requester's Phone *</label> <!-- Style Update: Proper Case -->
                    <input type="tel" id="requesterPhone" name="requesterPhone" class="form-input" placeholder="(xxx) xxx-xxxx" required> <!-- Functional Update: Simplified phone field -->
                    <div class="error-message" id="requesterPhone-error">Please enter your phone number</div>
                </div>
                
                <div class="button-container">
                    <button type="button" class="back-button" id="step2Back">Back</button>
                    <button type="button" class="next-button" id="step2Next">Next</button>
                </div>
            </div>
            
            <!-- Step 3: Skater Information -->
            <div class="form-step step-3">
                <div class="form-group">
                    <label for="skaterName1" class="form-label">Skater 1 Name *</label> <!-- Style Update: Proper Case -->
                    <input type="text" id="skaterName1" name="skaterName1" class="form-input" required>
                    <div class="error-message" id="skaterName1-error">Please enter the skater's name</div>
                </div>
                
                <div class="form-group">
                    <label for="numEvents1" class="form-label">Skater 1 # of Events *</label> <!-- Style Update: Proper Case -->
                    <input type="number" id="numEvents1" name="numEvents1" min="1" class="form-input" required>
                    <div class="error-message" id="numEvents1-error">Please enter the number of events</div>
                </div>
                
                <!-- Skater 2 -->
                <div class="form-group skater-checkbox-group visible"> <!-- Skater 2 checkbox always visible -->
                    <label class="checkbox-label">
                        <input type="checkbox" id="hasSkater2" name="hasSkater2" class="form-checkbox skater-toggle" data-skater="2">
                        I have a second skater
                    </label>
                </div>
                <div id="skaterFields2" class="skater-fields">
                    <div class="form-group">
                        <label for="skaterName2" class="form-label">Skater 2 Name *</label>
                        <input type="text" id="skaterName2" name="skaterName2" class="form-input">
                        <div class="error-message" id="skaterName2-error">Please enter the skater's name</div>
                    </div>
                    <div class="form-group">
                        <label for="numEvents2" class="form-label">Skater 2 # of Events *</label>
                        <input type="number" id="numEvents2" name="numEvents2" min="1" class="form-input">
                        <div class="error-message" id="numEvents2-error">Please enter the number of events</div>
                    </div>
                </div>

                <!-- Skater 3 -->
                <div class="form-group skater-checkbox-group" id="skaterCheckboxGroup3"> <!-- Initially hidden -->
                    <label class="checkbox-label">
                        <input type="checkbox" id="hasSkater3" name="hasSkater3" class="form-checkbox skater-toggle" data-skater="3">
                        I have a third skater
                    </label>
                </div>
                <div id="skaterFields3" class="skater-fields">
                    <div class="form-group">
                        <label for="skaterName3" class="form-label">Skater 3 Name *</label>
                        <input type="text" id="skaterName3" name="skaterName3" class="form-input">
                        <div class="error-message" id="skaterName3-error">Please enter the skater's name</div>
                    </div>
                    <div class="form-group">
                        <label for="numEvents3" class="form-label">Skater 3 # of Events *</label>
                        <input type="number" id="numEvents3" name="numEvents3" min="1" class="form-input">
                        <div class="error-message" id="numEvents3-error">Please enter the number of events</div>
                    </div>
                </div>

                <!-- Skater 4 -->
                <div class="form-group skater-checkbox-group" id="skaterCheckboxGroup4"> <!-- Initially hidden -->
                    <label class="checkbox-label">
                        <input type="checkbox" id="hasSkater4" name="hasSkater4" class="form-checkbox skater-toggle" data-skater="4">
                        I have a fourth skater
                    </label>
                </div>
                <div id="skaterFields4" class="skater-fields">
                    <div class="form-group">
                        <label for="skaterName4" class="form-label">Skater 4 Name *</label>
                        <input type="text" id="skaterName4" name="skaterName4" class="form-input">
                        <div class="error-message" id="skaterName4-error">Please enter the skater's name</div>
                    </div>
                    <div class="form-group">
                        <label for="numEvents4" class="form-label">Skater 4 # of Events *</label>
                        <input type="number" id="numEvents4" name="numEvents4" min="1" class="form-input">
                        <div class="error-message" id="numEvents4-error">Please enter the number of events</div>
                    </div>
                </div>

                <!-- Skater 5 -->
                <div class="form-group skater-checkbox-group" id="skaterCheckboxGroup5"> <!-- Initially hidden -->
                    <label class="checkbox-label">
                        <input type="checkbox" id="hasSkater5" name="hasSkater5" class="form-checkbox skater-toggle" data-skater="5">
                        I have a fifth skater
                    </label>
                </div>
                <div id="skaterFields5" class="skater-fields">
                    <div class="form-group">
                        <label for="skaterName5" class="form-label">Skater 5 Name *</label>
                        <input type="text" id="skaterName5" name="skaterName5" class="form-input">
                        <div class="error-message" id="skaterName5-error">Please enter the skater's name</div>
                    </div>
                    <div class="form-group">
                        <label for="numEvents5" class="form-label">Skater 5 # of Events *</label>
                        <input type="number" id="numEvents5" name="numEvents5" min="1" class="form-input">
                        <div class="error-message" id="numEvents5-error">Please enter the number of events</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="additionalInfo" class="form-label">Anything Else I Should Know?</label> <!-- Style Update: Proper Case -->
                    <textarea id="additionalInfo" name="additionalInfo" class="form-textarea"></textarea>
                </div>
                
                <div class="button-container">
                    <button type="button" class="back-button" id="step3Back">Back</button>
                    <button type="submit" class="submit-button">Submit</button>
                </div>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const competitionForm = document.getElementById('competitionForm');
            const step1 = document.querySelector('.step-1');
            const step2 = document.querySelector('.step-2');
            const step3 = document.querySelector('.step-3');
            const step1Next = document.getElementById('step1Next');
            const step2Back = document.getElementById('step2Back');
            const step2Next = document.getElementById('step2Next');
            const step3Back = document.getElementById('step3Back');
            const stepDots = document.querySelectorAll('.step-dot');
            
            // Dynamic competition list
            const competitions = ['2025 Snowball', '2025 Skate KC', '2025 Meet Me in St. Louis', '2025 Autumn Classic', '2025 Winter Showcase'];
            const competitionSelect = document.getElementById('competitionSelect');
            
            // Populate competition dropdown
            competitions.forEach(comp => {
                const option = document.createElement('option');
                option.value = comp;
                option.textContent = comp;
                competitionSelect.appendChild(option);
            });
            
            // Step navigation
            function goToStep(stepNumber) {
                [step1, step2, step3].forEach(step => step.classList.remove('active'));
                document.querySelector(`.step-${stepNumber}`).classList.add('active');
                
                stepDots.forEach(dot => {
                    dot.classList.remove('active');
                    if (parseInt(dot.dataset.step) === stepNumber) {
                        dot.classList.add('active');
                    }
                });
            }
            
            // Validation function
            function validateStep(stepNumber) {
                let isValid = true;
                const stepElement = document.querySelector(`.step-${stepNumber}`);
                const requiredInputs = stepElement.querySelectorAll('[required]');
                
                // Clear previous errors
                stepElement.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
                
                requiredInputs.forEach(input => {
                    if (!input.value) {
                        const errorElement = document.getElementById(`${input.id}-error`);
                        if (errorElement) {
                            errorElement.style.display = 'block';
                        }
                        isValid = false;
                    } else if (input.type === 'email' && !/^\S+@\S+\.\S+$/.test(input.value)) {
                        const errorElement = document.getElementById(`${input.id}-error`);
                        if (errorElement) {
                            errorElement.style.display = 'block';
                        }
                        isValid = false;
                    }
                });
                return isValid;
            }
            
            // Step 1 -> Step 2
            step1Next.addEventListener('click', function() {
                if (validateStep(1)) {
                    goToStep(2);
                }
            });
            
            // Step 2 -> Step 1
            step2Back.addEventListener('click', function() {
                goToStep(1);
            });
            
            // Step 2 -> Step 3
            step2Next.addEventListener('click', function() {
                if (validateStep(2)) {
                    goToStep(3);
                }
            });
            
            // Step 3 -> Step 2
            step3Back.addEventListener('click', function() {
                goToStep(2);
            });
            
            // Skater checkbox logic (Sequential Display)
            const skaterToggles = document.querySelectorAll('.skater-toggle');
            
            skaterToggles.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const skaterNum = parseInt(this.dataset.skater);
                    const fieldsDiv = document.getElementById(`skaterFields${skaterNum}`);
                    const nameInput = document.getElementById(`skaterName${skaterNum}`);
                    const eventsInput = document.getElementById(`numEvents${skaterNum}`);
                    const nextCheckboxGroup = document.getElementById(`skaterCheckboxGroup${skaterNum + 1}`);
                    
                    if (this.checked) {
                        fieldsDiv.classList.add('active');
                        nameInput.required = true;
                        eventsInput.required = true;
                        if (nextCheckboxGroup) {
                            nextCheckboxGroup.classList.add('visible'); // Show next checkbox group
                        }
                    } else {
                        fieldsDiv.classList.remove('active');
                        nameInput.required = false;
                        eventsInput.required = false;
                        nameInput.value = ''; // Clear fields when unchecked
                        eventsInput.value = '';
                        
                        // Hide and uncheck all subsequent checkboxes and fields
                        for (let i = skaterNum + 1; i <= 5; i++) {
                            const subsequentCheckboxGroup = document.getElementById(`skaterCheckboxGroup${i}`);
                            const subsequentCheckbox = document.getElementById(`hasSkater${i}`);
                            const subsequentFieldsDiv = document.getElementById(`skaterFields${i}`);
                            const subsequentNameInput = document.getElementById(`skaterName${i}`);
                            const subsequentEventsInput = document.getElementById(`numEvents${i}`);
                            
                            if (subsequentCheckboxGroup) {
                                subsequentCheckboxGroup.classList.remove('visible');
                            }
                            if (subsequentCheckbox && subsequentCheckbox.checked) {
                                subsequentCheckbox.checked = false;
                                // Manually trigger change event for cascade effect
                                subsequentCheckbox.dispatchEvent(new Event('change')); 
                            }
                            if (subsequentFieldsDiv) {
                                subsequentFieldsDiv.classList.remove('active');
                            }
                            if (subsequentNameInput) {
                                subsequentNameInput.required = false;
                                subsequentNameInput.value = '';
                            }
                            if (subsequentEventsInput) {
                                subsequentEventsInput.required = false;
                                subsequentEventsInput.value = '';
                            }
                        }
                    }
                });
            });
            
            // Final form submission
            competitionForm.addEventListener('submit', function(event) {
                event.preventDefault();
                
                // Honeypot check
                const honeypot = competitionForm.querySelector('input[name="website"]');
                if (honeypot.value) {
                    console.log("Honeypot triggered, blocking submission.");
                    return; // Block submission if honeypot is filled
                }
                
                // Validate Step 3 fields before submitting
                let isStep3Valid = true;
                const step3Element = document.querySelector('.step-3');
                const requiredInputsStep3 = step3Element.querySelectorAll('.form-input[required]');
                
                // Clear previous errors in Step 3
                step3Element.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
                
                requiredInputsStep3.forEach(input => {
                    if (!input.value) {
                        const errorElement = document.getElementById(`${input.id}-error`);
                        if (errorElement) {
                            errorElement.style.display = 'block';
                        }
                        isStep3Valid = false;
                    }
                });
                
                if (isStep3Valid) {
                    // Form is valid, prepare data for submission
                    const formData = new FormData(competitionForm);
                    const formObject = {};
                    
                    formData.forEach((value, key) => {
                        // Exclude honeypot field from submitted data
                        if (key !== "website") {
                            formObject[key] = value;
                        }
                    });
                    
                    // For Google Sheets integration via Apps Script
                    // Replace the URL with your deployed Google Apps Script Web App URL
                    const scriptURL = "YOUR_GOOGLE_SCRIPT_WEB_APP_URL";
                    
                    fetch(scriptURL, {
                        method: "POST",
                        body: JSON.stringify(formObject),
                        headers: {
                            "Content-Type": "application/json"
                        }
                    })
                    .then(response => {
                        if (response.ok) {
                            // Redirect to thank-you page on success
                            window.location.href = "/thank-you.html";
                        } else {
                            alert("There was an error submitting the form. Please try again.");
                        }
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        alert("There was an error submitting the form. Please try again.");
                    });
                }
            });
        });
    </script>
</body>
</html>
